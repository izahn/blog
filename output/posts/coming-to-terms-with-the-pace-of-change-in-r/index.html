<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="R is changing rapidly and for the better. Keeping up is worth it.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coming to terms with the pace of change in R | Ista Zahn</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://people.fas.harvard.edu/~izahn/posts/coming-to-terms-with-the-pace-of-change-in-r/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="description" itemprop="description" content="R is changing rapidly and for the better. Keeping up is worth it.">
<meta name="author" content="Ista Zahn">
<link rel="prev" href="../extracting-content-from-pdf-files/" title="Extracting content from .pdf files" type="text/html">
<link rel="next" href="../resources-for-learning-r/" title="Resources for learning R" type="text/html">
<meta property="og:site_name" content="Ista Zahn">
<meta property="og:title" content="Coming to terms with the pace of change in R">
<meta property="og:url" content="http://people.fas.harvard.edu/~izahn/posts/coming-to-terms-with-the-pace-of-change-in-r/">
<meta property="og:description" content="R is changing rapidly and for the better. Keeping up is worth it.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-09-20T09:58:33-04:00">
<meta property="article:tag" content="R">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://people.fas.harvard.edu/~izahn/">

                <span id="blog-title">Ista Zahn</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../pages/about/">About me</a>
                </li>
<li>
<a href="../../archive/">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.org" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Coming to terms with the pace of change in R</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Ista Zahn
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2016-09-20T09:58:33-04:00" itemprop="datePublished" title="2016-09-20 09:58">2016-09-20 09:58</time></a></p>
                <p class="commentline">
        
        <a href="#isso-thread">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.org" id="sourcelink">Source</a></p>

                <meta name="description" itemprop="description" content="R is changing rapidly and for the better. Keeping up is worth it.">
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Is it you or have I become old and cranky?</h2>
<div class="outline-text-2" id="text-1">
<p>
I've been using R and mostly enjoying it since 2006. Lately I've been having some misgivings about the direction R as a community is headed. Some of these misgivings no doubt stem from reluctance to learn new ways of doing things after investing so much time mastering the old ways, but underneath my old-man crankiness I believe there are real and important challenges facing the R community. R has grown considerably since I started using it a decade ago, and this has mostly been a good thing as new packages implement new and better functionality. Recently, popular contributed packages have been replacing core R functionality with new approaches, leading to a fragmentation of the user base and increasing cognitive load by requiring analysts to choose a package (or set of packages) before they even write the first line of code.
</p>

<!-- TEASER_END -->
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">R is "a large, coherent, integrated collection of intermediate tools for data analysis"</h2>
<div class="outline-text-2" id="text-2">
<p>
The quote is taken from the official R manual <a href="https://cran.r-project.org/doc/manuals/R-intro.html#Introduction-and-preliminaries">An Introduction to R</a>. The "coherent" and "integrated" claims have always been questionable in some areas, but this situation is getting far worse as contributed packages re-invent basic R features and replace classic R idioms with new ones. Let me show you what I'm talking about.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Is there a coherent integrated "group by" in R?</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Suppose I want to aggregate a data set by calculating group sizes, means, and standard deviations. There are many ways to do it in base R, and none are quite satisfactory.
</p>

<p>
First up is the <code>tapply</code> function. It works well for simple aggregation, but won't help us here because it can only handle a single <code>x</code> variable, and it produces confusing return values if <code>FUN</code> returns a vector of length greater than one. That is to say, it works fine for calculating a single summary statistic by group
</p>
<div class="highlight"><pre><span></span><span class="kp">tapply</span><span class="p">(</span>mtcars<span class="o">$</span>wt<span class="p">,</span> mtcars<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">"am"</span><span class="p">,</span> <span class="s">"cyl"</span><span class="p">)],</span>
       FUN <span class="o">=</span> <span class="kp">mean</span><span class="p">)</span>
</pre></div>

<pre class="example">
   cyl
am        4       6        8
  0 2.93500 3.38875 4.104083
  1 2.04225 2.75500 3.370000
</pre>

<p>
but anything more complicated quickly becomes a mess
</p>
<div class="highlight"><pre><span></span><span class="kp">tapply</span><span class="p">(</span>mtcars<span class="o">$</span>wt<span class="p">,</span> mtcars<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">"am"</span><span class="p">,</span> <span class="s">"cyl"</span><span class="p">)],</span>
	FUN <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kt">c</span><span class="p">(</span>n <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>x<span class="p">),</span> mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">),</span> sd <span class="o">=</span> sd<span class="p">(</span>x<span class="p">)))</span>
</pre></div>

<pre class="example">
   cyl
am  4         6         8        
  0 Numeric,3 Numeric,3 Numeric,3
  1 Numeric,3 Numeric,3 Numeric,3
</pre>

<p>
Next we might consider the <code>ave</code> function, but a quick look at the documentation suggests it won't be any better than <code>tapply</code>. OK, let's try something else. Maybe <code>aggregate</code> will help us.
</p>
<div class="highlight"><pre><span></span>aggregate<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>mpg<span class="p">,</span> hp<span class="p">,</span> wt<span class="p">)</span> <span class="o">~</span> am <span class="o">+</span> cyl<span class="p">,</span>
	  data <span class="o">=</span> mtcars<span class="p">,</span>
	  FUN <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kt">c</span><span class="p">(</span>n <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>x<span class="p">),</span> mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">),</span> sd <span class="o">=</span> sd<span class="p">(</span>x<span class="p">)))</span>
</pre></div>

<pre class="example">
  am cyl      mpg.n   mpg.mean     mpg.sd      hp.n   hp.mean     hp.sd       wt.n    wt.mean      wt.sd
1  0   4  3.0000000 22.9000000  1.4525839   3.00000  84.66667  19.65536  3.0000000  2.9350000  0.4075230
2  1   4  8.0000000 28.0750000  4.4838599   8.00000  81.87500  22.65542  8.0000000  2.0422500  0.4093485
3  0   6  4.0000000 19.1250000  1.6317169   4.00000 115.25000   9.17878  4.0000000  3.3887500  0.1162164
4  1   6  3.0000000 20.5666667  0.7505553   3.00000 131.66667  37.52777  3.0000000  2.7550000  0.1281601
5  0   8 12.0000000 15.0500000  2.7743959  12.00000 194.16667  33.35984 12.0000000  4.1040833  0.7683069
6  1   8  2.0000000 15.4000000  0.5656854   2.00000 299.50000  50.20458  2.0000000  3.3700000  0.2828427
</pre>

<p>
<code>aggregate</code> appears to be closer to what we want than <code>tapply</code>, but it still either requires post-processing to remove the redundant group size column, or multiple calls to produce the desired result, e.g.,
</p>
<div class="highlight"><pre><span></span><span class="kp">merge</span><span class="p">(</span>aggregate<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>n <span class="o">=</span> mpg<span class="p">)</span> <span class="o">~</span> am <span class="o">+</span>cyl<span class="p">,</span>
		data <span class="o">=</span> mtcars<span class="p">,</span>
		FUN <span class="o">=</span> <span class="kp">length</span><span class="p">),</span>
      aggregate<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>mpg<span class="p">,</span> hp<span class="p">,</span> wt<span class="p">)</span> <span class="o">~</span> am <span class="o">+</span> cyl<span class="p">,</span>
		data <span class="o">=</span> mtcars<span class="p">,</span>
		FUN <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kt">c</span><span class="p">(</span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">),</span> sd <span class="o">=</span> sd<span class="p">(</span>x<span class="p">))))</span>
</pre></div>

<pre class="example">
  am cyl  n   mpg.mean     mpg.sd   hp.mean     hp.sd   wt.mean     wt.sd
1  0   4  3 22.9000000  1.4525839  84.66667  19.65536 2.9350000 0.4075230
2  0   6  4 19.1250000  1.6317169 115.25000   9.17878 3.3887500 0.1162164
3  0   8 12 15.0500000  2.7743959 194.16667  33.35984 4.1040833 0.7683069
4  1   4  8 28.0750000  4.4838599  81.87500  22.65542 2.0422500 0.4093485
5  1   6  3 20.5666667  0.7505553 131.66667  37.52777 2.7550000 0.1281601
6  1   8  2 15.4000000  0.5656854 299.50000  50.20458 3.3700000 0.2828427
</pre>

<p>
OK, <code>tapply</code> and <code>ave</code> were busts, aggregate is close but not quite what we want. How about <code>by</code>?
</p>

<div class="highlight"><pre><span></span><span class="kp">by</span><span class="p">(</span>mtcars<span class="p">,</span>
   mtcars<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">"am"</span><span class="p">,</span> <span class="s">"cyl"</span><span class="p">)],</span>
   FUN <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span>
   <span class="p">{</span>
     <span class="kp">with</span><span class="p">(</span>x<span class="p">,</span>
	  <span class="kt">c</span><span class="p">(</span>n <span class="o">=</span> <span class="kp">nrow</span><span class="p">(</span>x<span class="p">),</span>
	    mpg_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>mpg<span class="p">),</span>
	    mpg_sd <span class="o">=</span> sd<span class="p">(</span>mpg<span class="p">),</span>
	    hp_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>hp<span class="p">),</span>
	    hp_sd <span class="o">=</span> sd<span class="p">(</span>hp<span class="p">),</span>
	    wt_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>wt<span class="p">),</span>
	    wt_sd <span class="o">=</span> sd<span class="p">(</span>wt<span class="p">)))</span>
   <span class="p">},</span>
   simplify <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</pre></div>

<pre class="example">
 am: 0
cyl: 4
        n  mpg_mean    mpg_sd   hp_mean     hp_sd   wt_mean     wt_sd 
 3.000000 22.900000  1.452584 84.666667 19.655364  2.935000  0.407523 
------------------------------------------------------------------------------------- 
am: 1
cyl: 4
         n   mpg_mean     mpg_sd    hp_mean      hp_sd    wt_mean      wt_sd 
 8.0000000 28.0750000  4.4838599 81.8750000 22.6554156  2.0422500  0.4093485 
------------------------------------------------------------------------------------- 
am: 0
cyl: 6
          n    mpg_mean      mpg_sd     hp_mean       hp_sd     wt_mean       wt_sd 
  4.0000000  19.1250000   1.6317169 115.2500000   9.1787799   3.3887500   0.1162164 
------------------------------------------------------------------------------------- 
am: 1
cyl: 6
          n    mpg_mean      mpg_sd     hp_mean       hp_sd     wt_mean       wt_sd 
  3.0000000  20.5666667   0.7505553 131.6666667  37.5277675   2.7550000   0.1281601 
------------------------------------------------------------------------------------- 
am: 0
cyl: 8
          n    mpg_mean      mpg_sd     hp_mean       hp_sd     wt_mean       wt_sd 
 12.0000000  15.0500000   2.7743959 194.1666667  33.3598379   4.1040833   0.7683069 
------------------------------------------------------------------------------------- 
am: 1
cyl: 8
          n    mpg_mean      mpg_sd     hp_mean       hp_sd     wt_mean       wt_sd 
  2.0000000  15.4000000   0.5656854 299.5000000  50.2045815   3.3700000   0.2828427
</pre>

<p>
Well, maybe that's better. It's not really any less verbose than the aggregate-and-merge strategy, and the result isn't very friendly. Maybe we should just roll our own.
</p>
<div class="highlight"><pre><span></span><span class="kp">do.call</span><span class="p">(</span><span class="kp">rbind</span><span class="p">,</span>
	<span class="kp">lapply</span><span class="p">(</span><span class="kp">split</span><span class="p">(</span>mtcars<span class="p">,</span> mtcars<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">"am"</span><span class="p">,</span> <span class="s">"cyl"</span><span class="p">)]),</span>
	       <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
		 <span class="kp">with</span><span class="p">(</span>x<span class="p">,</span> 
		      <span class="kt">data.frame</span><span class="p">(</span>am <span class="o">=</span> <span class="kp">unique</span><span class="p">(</span>am<span class="p">),</span>
				 cyl <span class="o">=</span> <span class="kp">unique</span><span class="p">(</span>cyl<span class="p">),</span>
				 n <span class="o">=</span> <span class="kp">nrow</span><span class="p">(</span>x<span class="p">),</span>
				 mpg_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>mpg<span class="p">),</span>
				 mpg_sd <span class="o">=</span> sd<span class="p">(</span>mpg<span class="p">),</span>
				 hp_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>hp<span class="p">),</span>
				 hp_sd <span class="o">=</span> sd<span class="p">(</span>hp<span class="p">),</span>
				 wt_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>wt<span class="p">),</span>
				 wt_sd <span class="o">=</span> sd<span class="p">(</span>wt<span class="p">)))</span>
	       <span class="p">}))</span>
</pre></div>

<pre class="example">
    am cyl  n mpg_mean    mpg_sd   hp_mean    hp_sd  wt_mean     wt_sd
0.4  0   4  3 22.90000 1.4525839  84.66667 19.65536 2.935000 0.4075230
1.4  1   4  8 28.07500 4.4838599  81.87500 22.65542 2.042250 0.4093485
0.6  0   6  4 19.12500 1.6317169 115.25000  9.17878 3.388750 0.1162164
1.6  1   6  3 20.56667 0.7505553 131.66667 37.52777 2.755000 0.1281601
0.8  0   8 12 15.05000 2.7743959 194.16667 33.35984 4.104083 0.7683069
1.8  1   8  2 15.40000 0.5656854 299.50000 50.20458 3.370000 0.2828427
</pre>

<p>
By now we've tried four different approaches, but nothing seems to make the calculation particularly natural or convenient. Is this really a "coherent and integrated" collection of functions? It feels more like a haphazard collection of overlapping functions that can be abused in different ways. So here are some questions. 
</p>
<ol class="org-ol">
<li>Given that <code>aggregate</code> appears to be more flexible than <code>tapply</code> and <code>ave</code>, do we really need the later two?
</li>
<li>Can <code>aggregate</code> be generalized so that we can apply functions to data.frames instead of to the columns of those data.frames?
</li>
</ol>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Can we do better?</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Of course we can do better. Many an R programmer has gazed out over the rubble of <code>tapply</code>, <code>ave</code>, <code>by</code> and <code>aggregate</code> and mused "surely I can bring order and harmony to this jumble. Follow me and we will create a 'group by' operation to end all SQL jealousy in the kingdom of R." And what comes of this musing? Let us look with wonder upon the bubbling exuberant creativity of the R community.
</p>
</div>

<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">doBy::describeBy</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Very similar to <code>aggregate</code>, same limitations.
</p>
<div class="highlight"><pre><span></span>doBy<span class="o">::</span>summaryBy<span class="p">(</span>mpg <span class="o">+</span> hp <span class="o">+</span> wt <span class="o">~</span> am <span class="o">+</span> cyl<span class="p">,</span>
		data <span class="o">=</span> mtcars<span class="p">,</span>
		FUN <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kt">c</span><span class="p">(</span>n <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>x<span class="p">),</span> mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">),</span> sd <span class="o">=</span> sd<span class="p">(</span>x<span class="p">)))</span>
</pre></div>

<pre class="example">
  am cyl mpg.n mpg.mean    mpg.sd hp.n   hp.mean    hp.sd wt.n  wt.mean     wt.sd
1  0   4     3 22.90000 1.4525839    3  84.66667 19.65536    3 2.935000 0.4075230
2  0   6     4 19.12500 1.6317169    4 115.25000  9.17878    4 3.388750 0.1162164
3  0   8    12 15.05000 2.7743959   12 194.16667 33.35984   12 4.104083 0.7683069
4  1   4     8 28.07500 4.4838599    8  81.87500 22.65542    8 2.042250 0.4093485
5  1   6     3 20.56667 0.7505553    3 131.66667 37.52777    3 2.755000 0.1281601
6  1   8     2 15.40000 0.5656854    2 299.50000 50.20458    2 3.370000 0.2828427
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2">Hmisc::summary.formula</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Similar to aggregate, large number of confusing options. This one automatically computes N for each group, so it actually works for our example.
</p>
<div class="highlight"><pre><span></span>Hmisc<span class="o">::</span>summary.formula<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>mpg<span class="p">,</span> hp<span class="p">,</span> wt<span class="p">)</span> <span class="o">~</span> am <span class="o">+</span> cyl<span class="p">,</span>
		       data <span class="o">=</span> mtcars<span class="p">,</span>
		       fun <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
			 <span class="kp">apply</span><span class="p">(</span>x<span class="p">,</span>
			       <span class="m">2</span><span class="p">,</span>
			       FUN <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>y<span class="p">)</span> <span class="p">{</span>
				 <span class="kt">c</span><span class="p">(</span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>y<span class="p">),</span> sd <span class="o">=</span> sd<span class="p">(</span>y<span class="p">))</span>
			       <span class="p">})</span>
		       <span class="p">})</span>
</pre></div>

<pre class="example">
 cbind(mpg, hp, wt)    N=32

+-------+---+--+--------+--------+---------+--------+--------+---------+
|       |   |N |mpg mean|mpg sd  |hp mean  |hp sd   |wt mean |wt sd    |
+-------+---+--+--------+--------+---------+--------+--------+---------+
|am     |No |19|17.14737|3.833966|160.26316|53.90820|3.768895|0.7774001|
|       |Yes|13|24.39231|6.166504|126.84615|84.06232|2.411000|0.6169816|
+-------+---+--+--------+--------+---------+--------+--------+---------+
|cyl    |4  |11|26.66364|4.509828| 82.63636|20.93453|2.285727|0.5695637|
|       |6  | 7|19.74286|1.453567|122.28571|24.26049|3.117143|0.3563455|
|       |8  |14|15.10000|2.560048|209.21429|50.97689|3.999214|0.7594047|
+-------+---+--+--------+--------+---------+--------+--------+---------+
|Overall|   |32|20.09062|6.026948|146.68750|68.56287|3.217250|0.9784574|
+-------+---+--+--------+--------+---------+--------+--------+---------+
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-3" class="outline-4">
<h4 id="sec-2-2-3">dplyr::summarize</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
This one is very popular, and for good reason. It works well.
</p>
<div class="highlight"><pre><span></span>dplyr<span class="o">::</span>summarize<span class="p">(</span>dplyr<span class="o">::</span>group_by<span class="p">(</span>mtcars<span class="p">,</span> am<span class="p">,</span> cyl<span class="p">),</span>
		 n <span class="o">=</span> <span class="kp">length</span><span class="p">(</span>mpg<span class="p">),</span>
		 mean_mpg <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>mpg<span class="p">),</span>
		 sd_mpg <span class="o">=</span> sd<span class="p">(</span>mpg<span class="p">),</span>
		 mean_hp <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>hp<span class="p">),</span>
		 sd_hp <span class="o">=</span> sd<span class="p">(</span>hp<span class="p">),</span>
		 mean_wt <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>wt<span class="p">),</span>
		 sd_hp <span class="o">=</span> sd<span class="p">(</span>hp<span class="p">))</span>
</pre></div>

<pre class="example">
 Source: local data frame [6 x 8]
Groups: am [?]

     am   cyl     n mean_mpg    sd_mpg   mean_hp    sd_hp  mean_wt
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1     0     4     3 22.90000 1.4525839  84.66667 19.65536 2.935000
2     0     6     4 19.12500 1.6317169 115.25000  9.17878 3.388750
3     0     8    12 15.05000 2.7743959 194.16667 33.35984 4.104083
4     1     4     8 28.07500 4.4838599  81.87500 22.65542 2.042250
5     1     6     3 20.56667 0.7505553 131.66667 37.52777 2.755000
6     1     8     2 15.40000 0.5656854 299.50000 50.20458 3.370000
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-4" class="outline-4">
<h4 id="sec-2-2-4">dplyr::do</h4>
<div class="outline-text-4" id="text-2-2-4">
<p>
If you have a large number of columns to summarize you might not want to type them all out. In that case you can use <code>do</code>.
</p>
<div class="highlight"><pre><span></span>do<span class="p">(</span>group_by<span class="p">(</span>mtcars<span class="p">,</span> am<span class="p">,</span> cyl<span class="p">),</span>
   <span class="kp">as.data.frame</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="kt">list</span><span class="p">(</span>n <span class="o">=</span> <span class="kp">ncol</span><span class="p">(</span><span class="m">.</span><span class="p">)),</span>
		   <span class="kp">as.list</span><span class="p">(</span><span class="kp">sapply</span><span class="p">(</span><span class="m">.</span><span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">"mpg"</span><span class="p">,</span> <span class="s">"wt"</span><span class="p">,</span> <span class="s">"hp"</span><span class="p">)],</span>
				  <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kt">c</span><span class="p">(</span>mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">)))),</span>
		   <span class="kp">as.list</span><span class="p">(</span><span class="kp">sapply</span><span class="p">(</span><span class="m">.</span><span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">"mpg"</span><span class="p">,</span> <span class="s">"wt"</span><span class="p">,</span> <span class="s">"hp"</span><span class="p">)],</span>
				  <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="kt">c</span><span class="p">(</span>sd <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>x<span class="p">)))))))</span>
</pre></div>

<pre class="example">
 Source: local data frame [6 x 9]
Groups: am, cyl [6]

     am   cyl     n mpg.mean  wt.mean   hp.mean   mpg.sd    wt.sd     hp.sd
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1     0     4    11 22.90000 2.935000  84.66667 22.90000 2.935000  84.66667
2     0     6    11 19.12500 3.388750 115.25000 19.12500 3.388750 115.25000
3     0     8    11 15.05000 4.104083 194.16667 15.05000 4.104083 194.16667
4     1     4    11 28.07500 2.042250  81.87500 28.07500 2.042250  81.87500
5     1     6    11 20.56667 2.755000 131.66667 20.56667 2.755000 131.66667
6     1     8    11 15.40000 3.370000 299.50000 15.40000 3.370000 299.50000
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-5" class="outline-4">
<h4 id="sec-2-2-5">tables::tabular</h4>
<div class="outline-text-4" id="text-2-2-5">
<p>
This one focuses on creating LaTeX and HTML tables. It creates its own SAS-inspired mini-language that is IMO very confusing, though possibly worth it if you frequently need to create complex publication ready tables.
</p>
<div class="highlight"><pre><span></span><span class="c1">#library(tables)</span>
tables<span class="o">::</span>tabular<span class="p">((</span>Factor<span class="p">(</span>am<span class="p">))</span><span class="o">*</span><span class="p">(</span>Factor<span class="p">(</span>cyl<span class="p">))</span> <span class="o">~</span> <span class="p">(</span>n <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>mpg <span class="o">+</span> wt <span class="o">+</span> hp<span class="p">)</span><span class="o">*</span><span class="p">(</span>mean <span class="o">+</span> sd<span class="p">),</span> data <span class="o">=</span> mtcars<span class="p">)</span>
</pre></div>

<pre class="example">
                                                 
          mpg          wt           hp           
am cyl n  mean  sd     mean  sd     mean   sd    
0  4    3 22.90 1.4526 2.935 0.4075  84.67 19.655
   6    4 19.12 1.6317 3.389 0.1162 115.25  9.179
   8   12 15.05 2.7744 4.104 0.7683 194.17 33.360
1  4    8 28.07 4.4839 2.042 0.4093  81.88 22.655
   6    3 20.57 0.7506 2.755 0.1282 131.67 37.528
   8    2 15.40 0.5657 3.370 0.2828 299.50 50.205
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-6" class="outline-4">
<h4 id="sec-2-2-6">data.table::`[`</h4>
<div class="outline-text-4" id="text-2-2-6">
<p>
The data.table package implements an alternative to the venerable <code>data.frame</code> class in R and provides sophisticated manipulation via an indexing-like interface.
</p>
<div class="highlight"><pre><span></span>as.data.table<span class="p">(</span>mtcars<span class="p">)[,</span>
		      <span class="kt">list</span><span class="p">(</span>n <span class="o">=</span> <span class="m">.</span>N<span class="p">,</span>
			   mpg_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>mpg<span class="p">),</span>
			   mpg_sd <span class="o">=</span> sd<span class="p">(</span>mpg<span class="p">),</span>
			   wt_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>wt<span class="p">),</span>
			   wt_sd <span class="o">=</span> sd<span class="p">(</span>wt<span class="p">),</span>
			   hp_mean <span class="o">=</span> <span class="kp">mean</span><span class="p">(</span>hp<span class="p">),</span>
			   hp_sd <span class="o">=</span> sd<span class="p">(</span>hp<span class="p">)),</span>
		      by <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">"am"</span><span class="p">,</span> <span class="s">"cyl"</span><span class="p">)]</span>
</pre></div>

<p>
Are we done yet? Well, I'm going to stop, but we could go on. There are at least 9 ways to skin this particular cat in R. 
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">How do I <span class="underline">_</span> in R?</h3>
<div class="outline-text-3" id="text-2-3">
<p>
So there are lots of ways to calculate statistics by some grouping variable(s) in R. Why can't you be happy that you have so many excellent choices?
</p>

<p>
I can't be happy about it because it makes my life more difficult. First, I need to identify my options. Then I need to evaluate them, and learn the particulars of my chosen package. This all takes effort that I would rather spend on other things. Now, if this problem was limited to the domain of calculating statistics by group, I wouldn't be writing this post. But this issue is almost everywhere in R.
</p>
</div>

<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1">How do I read text data?</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
I have a .csv file I want to read into R. Should I use
</p>
<ul class="org-ul">
<li>read.csv
</li>
<li>readr::read<sub>csv</sub>
</li>
<li>data.table::fread
</li>
<li>rio::import
</li>
<li>hypoparsr::parse<sub>file</sub>
</li>
<li>cvsread::cvsread
</li>
</ul>
<p>
or something else?
</p>
</div>
</div>

<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2">How do I fit a linear regression model?</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
I want to fit a simple linear regression model. Should I use
</p>
<ul class="org-ul">
<li>lm
</li>
<li>rms::ols
</li>
<li>Zelig::zlm
</li>
<li>glm2::glm2
</li>
</ul>
<p>
or something else?
</p>
</div>
</div>

<div id="outline-container-sec-2-3-3" class="outline-4">
<h4 id="sec-2-3-3">How do I make a table from model coefficients?</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
I've fit a model and would like to put the results in a nice table. Should I use
</p>
<ul class="org-ul">
<li>xtable::xtable
</li>
<li>rockchalk::outreg
</li>
<li>apsrtable::apsrtable
</li>
<li>htmlTable::htmlTable
</li>
<li>etable::tabular.ade
</li>
<li>knitr::ktable
</li>
<li>texreg::texreg
</li>
<li>stargazer::stargazer
</li>
<li>ascii::ascii
</li>
<li>estout::esttab
</li>
</ul>
<p>
or some other thing?
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">
<span class="todo TODO">TODO</span> Summary [summarize the post thus far]</h3>
<div class="outline-text-3" id="text-2-4">
<p>
There is an overwhelming number of choices for doing just about anything in R.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">What is R really?</h2>
<div class="outline-text-2" id="text-3">
<p>
OK, so there is some duplication among R functions and packages and people need to choose. There are both good and bad consequences of this, but the totality of the situation is that <b>it is no longer clear what R is</b>.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">R is not data.frames</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Most people who use R use it for statistical analysis and graphics. The basic data structure in most popular statistical package is a rectangular structure with variables in the columns and observations in the rows. In R this structure is called a <code>data.frame</code> and learning how to operate on and with data.frames is a basic skill that any R user must have.
</p>

<p>
The previous sentence may have been true at one time, but it no longer is. There are now at least three popular alternatives; <code>data.frame</code>, <code>data.table</code> and <code>tibble</code>. It is now possible to carry out sophisticated data manipulation and analysis in R without ever learning fundamental <code>data.frame</code> methods such as `[.data.frame`. All of these methods work differently.
</p>
<div class="highlight"><pre><span></span><span class="kp">head</span><span class="p">(</span>mtcars<span class="p">)[,</span> <span class="m">1</span><span class="p">]</span>
</pre></div>

<pre class="example">
[1] 21.0 21.0 22.8 21.4 18.7 18.1
</pre>

<div class="highlight"><pre><span></span>as.data.table<span class="p">(</span><span class="kp">head</span><span class="p">(</span>mtcars<span class="p">))[,</span> <span class="m">1</span><span class="p">]</span>
</pre></div>

<pre class="example">
[1] 1
</pre>

<div class="highlight"><pre><span></span>as_tibble<span class="p">(</span><span class="kp">head</span><span class="p">(</span>mtcars<span class="p">))[,</span> <span class="m">1</span><span class="p">]</span>
</pre></div>

<pre class="example">
# A tibble: 6 × 1
    mpg
  &lt;dbl&gt;
1  21.0
2  21.0
3  22.8
4  21.4
5  18.7
6  18.1
</pre>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">R is not a language that uses parenthetical argument lists, like c</h3>
<div class="outline-text-3" id="text-3-2">
<p>
One of the first things I used to teach people about R is that function calls have the form <code>functionName(arg1, arg2, ..., argn)</code>, and that even when all arguments are optional and you want to accept the defaults you need the <code>()</code> after the function name. This is no longer true. Many people now write strange looking R expressions like
</p>
<div class="highlight"><pre><span></span><span class="kn">library</span><span class="p">(</span>magrittr<span class="p">)</span>
mtcars <span class="o">%&gt;%</span> <span class="kp">head</span>
</pre></div>

<p>
R has always had flexible syntax, but with developments like this you can write R that looks nothing like what us old-timers expect R code to be.
</p>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">R is not coherent</h3>
<div class="outline-text-3" id="text-3-3">
<p>
There is no <a href="https://www.python.org/dev/peps/pep-0020/#the-zen-of-python">zen-like "one obvious way to do it"</a> it R. 
</p>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">R is being built phoenix-like from its own ashes</h3>
<div class="outline-text-3" id="text-3-4">
<p>
There is good news and there is bad news. The good news is that new and more coherent and integrated zones are being carved out of the R landscape. For example, the <a href="https://blog.rstudio.org/2016/09/15/tidyverse-1-0-0/">tidyverse</a> brings greater simplicity and constancy to many common operations in R. The bad news is that you can't escape the cold hard <a href="http://xkcd.com/927/">XKCD reality</a> that producing a "better" way of doing things means there is <span class="underline">one more</span> way of doing that thing. 
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">And now, the thrilling conclusion</h2>
<div class="outline-text-2" id="text-4">
<p>
Now finally we've reach the part of the blog where I tell you how everyone is doing it wrong and if you would just listen to me we could solve all our problems. The truth is I don't have great answers or solutions for these issues. The best I can do is offer some general thoughts.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">It could be worse</h3>
<div class="outline-text-3" id="text-4-1">
<p>
This post probably sounds critical of R, but don't get me wrong, I'm a huge fan of R. Every time I venture into Python, Javascript, Scala, or even Julia it makes me appreciate R even more. R is easy and useful, and having too much choice is certainly better than having too little.
</p>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">We can do better</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Collaborate more. Update documentation to recommend current best-of-breed packages.
</p>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/r/" rel="tag">R</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../extracting-content-from-pdf-files/" rel="prev" title="Extracting content from .pdf files">Previous post</a>
            </li>
            <li class="next">
                <a href="../resources-for-learning-r/" rel="next" title="Resources for learning R">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div data-title="Coming+to+terms+with+the+pace+of+change+in+R" id="isso-thread"></div>
        <script src="http://dss.izahn.com:8080/js/embed.min.js" data-isso="http://dss.izahn.com:8080/"></script></section></article>
</div>
        <!--End of body content-->

        <footer id="footer"><p>
Blogroll: - <a href="http://www.r-bloggers.com/">R-bloggers</a> - <a href="http://dss.iq.harvard.edu/blog"> Data Science Services </a>
</p>
<p>
Contents © 2016 <a href="mailto:istazahn@gmail.com">Ista Zahn</a>

<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:6px;" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a>
- Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
</p>

            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79557911-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>

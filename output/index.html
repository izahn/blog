<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://people.fas.harvard.edu/~izahn/">
<meta name="description" content="Bits and bobs related to data science and programming">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ista Zahn</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://people.fas.harvard.edu/~izahn/">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/reading-data-with-non-native-encoding-in-r/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://people.fas.harvard.edu/~izahn/">

                <span id="blog-title">Ista Zahn</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="pages/about/">About me</a>
                </li>
<li>
<a href="archive/">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/reading-data-with-non-native-encoding-in-r/" class="u-url">Escaping from character encoding hell in R on Windows</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Ista Zahn
            </span></p>
            <p class="dateline"><a href="posts/reading-data-with-non-native-encoding-in-r/" rel="bookmark"><time class="published dt-published" datetime="2016-06-14T13:57:09-04:00" title="2016-06-14 13:57">2016-06-14 13:57</time></a></p>
                <p class="commentline">
        
        <a href="posts/reading-data-with-non-native-encoding-in-r/#isso-thread">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <div>
<p>
Note: the title of this post was inspired by <a href="http://stackoverflow.com/questions/18789330/r-on-windows-character-encoding-hell">this question on stackoverflow</a>.
</p>

<p>
This section gives the basic facts and recommendations for importing files with arbitrary encoding on Windows. The issues described here by and large to not apply on Mac or Linux; they are specific to running <a href="http:r-project.org">R</a> on Windows.
</p>

<p>
If you are on a deadline and just need to get the job done this section should be all you need. Additional background and discussion is presented in later sections.
</p>

<p>
To read a text file with non ASCII encoding into R you should a) determine the encoding and b) read it in such a way that the information is re-encoded into UTF-8, and c) ignore the bug in the <code>data.frame</code> print method on Windows. Hopefully the encoding is specified in the documentation that accompanied your data. If not, you can guess the encoding using the <code>stri_read_raw</code> and <code>stri_enc_detect</code> functions in the <a href="http://www.gagolewski.com/software/stringi/">stringi</a>  package. You can ensure that the information is re-encoded to UTF-8 by using the <a href="https://github.com/hadley/readr">readr</a> package.
</p>

<p>
For example, I have two versions of a file containing numbers and Japanese characters: <code>japanese_utf8.csv</code> is encoded in UTF-8, and <code>japanese_shiftjis.csv</code> is encoded in SHIFT-JIS. We can read these files as follows on any platform (Windows, Linux, Mac):
</p>

<div class="highlight"><pre><span></span><span class="kn">library</span><span class="p">(</span>readr<span class="p">)</span>
<span class="kp">options</span><span class="p">(</span>stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
read_csv<span class="p">(</span><span class="s">"japanese_utf8.csv"</span><span class="p">,</span>
	 locale <span class="o">=</span> locale<span class="p">(</span>encoding <span class="o">=</span> <span class="s">"UTF-8"</span><span class="p">))</span>
read_csv<span class="p">(</span><span class="s">"japanese_shiftjis.csv"</span><span class="p">,</span>
	 locale <span class="o">=</span> locale<span class="p">(</span>encoding <span class="o">=</span> <span class="s">"SHIFT-JIS"</span><span class="p">))</span>
</pre></div>

<pre class="example">
    No.         発行日 朝夕刊     面名 ページ
1 00001 2015年09月25日   週刊 週刊朝日    022
2 00002 2015年09月25日   週刊 週刊朝日    018
3 00003 2015年09月21日   朝刊   ３総合    003
    No.         発行日 朝夕刊     面名 ページ
1 00001 2015年09月25日   週刊 週刊朝日    022
2 00002 2015年09月25日   週刊 週刊朝日    018
3 00003 2015年09月21日   朝刊   ３総合    003
</pre>

<p>
On Windows there is a bug in <code>print.data.frame</code> that causes <code>data.frame</code>'s with UTF-8 encoded columns to be displayed incorrectly in non UTF-8 locales. Running the above example on Windows produces this:
</p>

<pre class="example">
    No.         &lt;U+767A&gt;&lt;U+884C&gt;&lt;U+65E5&gt; &lt;U+671D&gt;&lt;U+5915&gt;&lt;U+520A&gt;                 &lt;U+9762&gt;&lt;U+540D&gt; &lt;U+30DA&gt;&lt;U+30FC&gt;&lt;U+30B8&gt;
1 00001 2015&lt;U+5E74&gt;09&lt;U+6708&gt;25&lt;U+65E5&gt;         &lt;U+9031&gt;&lt;U+520A&gt; &lt;U+9031&gt;&lt;U+520A&gt;&lt;U+671D&gt;&lt;U+65E5&gt;                      022
2 00002 2015&lt;U+5E74&gt;09&lt;U+6708&gt;25&lt;U+65E5&gt;         &lt;U+9031&gt;&lt;U+520A&gt; &lt;U+9031&gt;&lt;U+520A&gt;&lt;U+671D&gt;&lt;U+65E5&gt;                      018
3 00003 2015&lt;U+5E74&gt;09&lt;U+6708&gt;21&lt;U+65E5&gt;         &lt;U+671D&gt;&lt;U+520A&gt;                3&lt;U+7DCF&gt;&lt;U+5408&gt;                      003

    No.         &lt;U+767A&gt;&lt;U+884C&gt;&lt;U+65E5&gt; &lt;U+671D&gt;&lt;U+5915&gt;&lt;U+520A&gt;                 &lt;U+9762&gt;&lt;U+540D&gt; &lt;U+30DA&gt;&lt;U+30FC&gt;&lt;U+30B8&gt;
1 00001 2015&lt;U+5E74&gt;09&lt;U+6708&gt;25&lt;U+65E5&gt;         &lt;U+9031&gt;&lt;U+520A&gt; &lt;U+9031&gt;&lt;U+520A&gt;&lt;U+671D&gt;&lt;U+65E5&gt;                      022
2 00002 2015&lt;U+5E74&gt;09&lt;U+6708&gt;25&lt;U+65E5&gt;         &lt;U+9031&gt;&lt;U+520A&gt; &lt;U+9031&gt;&lt;U+520A&gt;&lt;U+671D&gt;&lt;U+65E5&gt;                      018
3 00003 2015&lt;U+5E74&gt;09&lt;U+6708&gt;21&lt;U+65E5&gt;         &lt;U+671D&gt;&lt;U+520A&gt;                3&lt;U+7DCF&gt;&lt;U+5408&gt;                      003
</pre>
<p>
which looks terrible but does not actually indicate a problem. The information is encoded correctly, but due to a long-standing bug it is <span class="underline">displayed</span> incorrectly. You can check to see if the values are correct by converting the data.frame by (ab)using <code>print.listof</code>, e.g.,
</p>

<div class="highlight"><pre><span></span><span class="kp">print.listof</span><span class="p">(</span>read_csv<span class="p">(</span><span class="s">"japanese_shiftjis.csv"</span><span class="p">,</span>
		      locale <span class="o">=</span> locale<span class="p">(</span>encoding <span class="o">=</span> <span class="s">"SHIFT-JIS"</span><span class="p">)))</span>
</pre></div>

<pre class="example">
No. :
[1] "00001" "00002" "00003"

発行日 :
[1] "2015年09月25日" "2015年09月25日" "2015年09月21日"

朝夕刊 :
[1] "週刊" "週刊" "朝刊"

面名 :
[1] "週刊朝日" "週刊朝日" "３総合"  

ページ :
[1] "022" "018" "003"
</pre>

<p>
To recap: 
</p>
<ul class="org-ul">
<li>Regardless of platform (Windows, Mac Linux), use the <a href="https://github.com/hadley/readr">readr</a> package to read data into R. This will re-encode the contents of the file to UTF-8 for you. 
</li>
<li>Make sure you specify the encoding using the <code>locale</code> argument as shown in the example above. 
</li>
<li>Ignore the ugly <code>print.data.frame</code> bug and use <code>print.listof</code> to check that your data was imported correctly.
</li>
</ul>
<p>
Those wishing for more details about this issue can read on.
</p>

<p class="more"><a href="posts/reading-data-with-non-native-encoding-in-r/">Read more…</a></p>
</div>
    </div>
    </article>
</div>



        
        <script src="http://dss.izahn.com:8080/js/count.min.js" data-isso="http://dss.izahn.com:8080/"></script>
</div>
        <!--End of body content-->

        <footer id="footer"><p>
Blogroll: - <a href="http://www.r-bloggers.com/">R-bloggers</a> - <a href="http://dss.iq.harvard.edu/blog"> Data Science Services </a>
</p>
<p>
Contents © 2016 <a href="mailto:istazahn@gmail.com">Ista Zahn</a>

<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:6px;" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a>
- Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
</p>

            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79557911-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
